{"ast":null,"code":"import * as mixpanel from 'mixpanel-browser';\nexport const EndPoints = {\n  CONFIG: '/callosum/v1/system/config'\n};\nexport const MIXPANEL_EVENT = {\n  VISUAL_SDK_RENDER_START: 'visual-sdk-render-start',\n  VISUAL_SDK_CALLED_INIT: 'visual-sdk-called-init',\n  VISUAL_SDK_RENDER_COMPLETE: 'visual-sdk-render-complete',\n  VISUAL_SDK_RENDER_FAILED: 'visual-sdk-render-failed',\n  VISUAL_SDK_TRIGGER: 'visual-sdk-trigger',\n  VISUAL_SDK_IFRAME_LOAD_PERFORMANCE: 'visual-sdk-iframe-load-performance'\n};\nlet isEventCollectorOn = false;\nconst eventCollectorQueue = [];\nfunction setEventCollectorOn() {\n  isEventCollectorOn = true;\n}\nfunction getEventCollectorOnValue() {\n  return isEventCollectorOn;\n}\n/**\n * Pushes the event with its Property key-value map to mixpanel.\n * @param eventId\n * @param eventProps\n */\nexport async function uploadMixpanelEvent(eventId) {\n  let eventProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (!getEventCollectorOnValue()) {\n    eventCollectorQueue.push({\n      eventId,\n      eventProps\n    });\n    return Promise.resolve();\n  }\n  return new Promise(() => mixpanel.track(eventId, eventProps));\n}\nfunction emptyQueue() {\n  eventCollectorQueue.forEach(event => {\n    uploadMixpanelEvent(event.eventId, event.eventProps);\n  });\n}\nexport function initMixpanel(sessionInfo) {\n  if (!sessionInfo || !sessionInfo.mixpanelToken) {\n    return;\n  }\n  // On a public cluster the user is anonymous, so don't set the identify to userGUID\n  const isPublicCluster = !!sessionInfo.isPublicUser;\n  const token = sessionInfo.mixpanelToken;\n  if (token) {\n    mixpanel.init(token);\n    if (!isPublicCluster) {\n      mixpanel.identify(sessionInfo.userGUID);\n    }\n    setEventCollectorOn();\n    emptyQueue();\n  }\n}","map":{"version":3,"mappings":"AAAA,OAAO,KAAKA,QAAQ,MAAM,kBAAkB;AAE5C,OAAO,MAAMC,SAAS,GAAG;EACrBC,MAAM,EAAE;CACX;AAED,OAAO,MAAMC,cAAc,GAAG;EAC1BC,uBAAuB,EAAE,yBAAyB;EAClDC,sBAAsB,EAAE,wBAAwB;EAChDC,0BAA0B,EAAE,4BAA4B;EACxDC,wBAAwB,EAAE,0BAA0B;EACpDC,kBAAkB,EAAE,oBAAoB;EACxCC,kCAAkC,EAAE;CACvC;AAED,IAAIC,kBAAkB,GAAG,KAAK;AAC9B,MAAMC,mBAAmB,GAA2C,EAAE;AAEtE,SAASC,mBAAmB;EACxBF,kBAAkB,GAAG,IAAI;AAC7B;AAEA,SAASG,wBAAwB;EAC7B,OAAOH,kBAAkB;AAC7B;AAEA;;;;;AAKA,OAAO,eAAeI,mBAAmB,CACrCC,OAAe,EACA;EAAA,IAAfC,UAAU,uEAAG,EAAE;EAEf,IAAI,CAACH,wBAAwB,EAAE,EAAE;IAC7BF,mBAAmB,CAACM,IAAI,CAAC;MAAEF,OAAO;MAAEC;IAAU,CAAE,CAAC;IACjD,OAAOE,OAAO,CAACC,OAAO,EAAE;;EAE5B,OAAO,IAAID,OAAO,CAAC,MAAMlB,QAAQ,CAACoB,KAAK,CAACL,OAAO,EAAEC,UAAU,CAAC,CAAC;AACjE;AAEA,SAASK,UAAU;EACfV,mBAAmB,CAACW,OAAO,CAAEC,KAAK,IAAI;IAClCT,mBAAmB,CAACS,KAAK,CAACR,OAAO,EAAEQ,KAAK,CAACP,UAAU,CAAC;EACxD,CAAC,CAAC;AACN;AAEA,OAAM,SAAUQ,YAAY,CAACC,WAAgB;EACzC,IAAI,CAACA,WAAW,IAAI,CAACA,WAAW,CAACC,aAAa,EAAE;IAC5C;;EAEJ;EACA,MAAMC,eAAe,GAAG,CAAC,CAACF,WAAW,CAACG,YAAY;EAClD,MAAMC,KAAK,GAAGJ,WAAW,CAACC,aAAa;EACvC,IAAIG,KAAK,EAAE;IACP7B,QAAQ,CAAC8B,IAAI,CAACD,KAAK,CAAC;IACpB,IAAI,CAACF,eAAe,EAAE;MAClB3B,QAAQ,CAAC+B,QAAQ,CAACN,WAAW,CAACO,QAAQ,CAAC;;IAE3CpB,mBAAmB,EAAE;IACrBS,UAAU,EAAE;;AAEpB","names":["mixpanel","EndPoints","CONFIG","MIXPANEL_EVENT","VISUAL_SDK_RENDER_START","VISUAL_SDK_CALLED_INIT","VISUAL_SDK_RENDER_COMPLETE","VISUAL_SDK_RENDER_FAILED","VISUAL_SDK_TRIGGER","VISUAL_SDK_IFRAME_LOAD_PERFORMANCE","isEventCollectorOn","eventCollectorQueue","setEventCollectorOn","getEventCollectorOnValue","uploadMixpanelEvent","eventId","eventProps","push","Promise","resolve","track","emptyQueue","forEach","event","initMixpanel","sessionInfo","mixpanelToken","isPublicCluster","isPublicUser","token","init","identify","userGUID"],"sources":["C:\\Users\\user\\Desktop\\kipithonteam2\\myapp\\snowspot-app\\node_modules\\@thoughtspot\\visual-embed-sdk\\src\\mixpanel-service.ts"],"sourcesContent":["import * as mixpanel from 'mixpanel-browser';\n\nexport const EndPoints = {\n    CONFIG: '/callosum/v1/system/config',\n};\n\nexport const MIXPANEL_EVENT = {\n    VISUAL_SDK_RENDER_START: 'visual-sdk-render-start',\n    VISUAL_SDK_CALLED_INIT: 'visual-sdk-called-init',\n    VISUAL_SDK_RENDER_COMPLETE: 'visual-sdk-render-complete',\n    VISUAL_SDK_RENDER_FAILED: 'visual-sdk-render-failed',\n    VISUAL_SDK_TRIGGER: 'visual-sdk-trigger',\n    VISUAL_SDK_IFRAME_LOAD_PERFORMANCE: 'visual-sdk-iframe-load-performance',\n};\n\nlet isEventCollectorOn = false;\nconst eventCollectorQueue: { eventId: string; eventProps: any }[] = [];\n\nfunction setEventCollectorOn() {\n    isEventCollectorOn = true;\n}\n\nfunction getEventCollectorOnValue() {\n    return isEventCollectorOn;\n}\n\n/**\n * Pushes the event with its Property key-value map to mixpanel.\n * @param eventId\n * @param eventProps\n */\nexport async function uploadMixpanelEvent(\n    eventId: string,\n    eventProps = {},\n): Promise<any> {\n    if (!getEventCollectorOnValue()) {\n        eventCollectorQueue.push({ eventId, eventProps });\n        return Promise.resolve();\n    }\n    return new Promise(() => mixpanel.track(eventId, eventProps));\n}\n\nfunction emptyQueue() {\n    eventCollectorQueue.forEach((event) => {\n        uploadMixpanelEvent(event.eventId, event.eventProps);\n    });\n}\n\nexport function initMixpanel(sessionInfo: any): void {\n    if (!sessionInfo || !sessionInfo.mixpanelToken) {\n        return;\n    }\n    // On a public cluster the user is anonymous, so don't set the identify to userGUID\n    const isPublicCluster = !!sessionInfo.isPublicUser;\n    const token = sessionInfo.mixpanelToken;\n    if (token) {\n        mixpanel.init(token);\n        if (!isPublicCluster) {\n            mixpanel.identify(sessionInfo.userGUID);\n        }\n        setEventCollectorOn();\n        emptyQueue();\n    }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}